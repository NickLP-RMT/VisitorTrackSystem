<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ - RMT Visitor Check-in</title>
  <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,#091f82 0%,#ffffff 100%);
      min-height:100vh;padding:20px;color:#333;line-height:1.6;
    }
    .header{
      background:rgba(255,255,255,.95);backdrop-filter:blur(10px);
      width:100%;max-width:650px;margin:0 auto 20px;padding:20px;
      border-radius:20px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.1)
    }
    .logo-section{margin-bottom:15px}
    .company-name{font-size:24px;font-weight:700;color:#2c5282;margin-bottom:5px;letter-spacing:.5px}
    .system-title{font-size:14px;color:#4a5568;font-weight:500;text-transform:uppercase;letter-spacing:1px}
    .container{
      width:100%;max-width:650px;margin:0 auto;background:rgba(255,255,255,.98);
      backdrop-filter:blur(10px);padding:30px;border-radius:20px;
      box-shadow:0 20px 40px rgba(0,0,0,.15);position:relative;overflow:hidden
    }
    .container::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#2c5282,#3182ce,#4299e1)}
    .main-title{text-align:center;color:#2c5282;margin-bottom:30px;font-size:24px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:10px}
    .form-section{background:#f8fafc;padding:25px;border-radius:15px;margin-bottom:25px;border:1px solid #e2e8f0}
    .section-title{font-size:16px;font-weight:600;color:#2d3748;margin-bottom:20px;display:flex;align-items:center;gap:8px}
    .form-group{margin-bottom:20px}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px}
    label{display:block;margin-bottom:8px;font-weight:600;font-size:14px;color:#2d3748}
    .required{color:#e53e3e}
    input,select{
      width:100%;padding:12px 16px;border-radius:10px;border:2px solid #e2e8f0;
      font-size:15px;transition:all .3s ease;background:#fff
    }
    input:focus,select:focus{outline:none;border-color:#3182ce;box-shadow:0 0 0 3px rgba(49,130,206,.1)}
    input:invalid{border-color:#fc8181}
    .row-inline{display:flex;align-items:center;gap:10px}
    .muted{font-size:13px;color:#4a5568}
    .total-pill{padding:8px 12px;border-radius:999px;background:#e6fffa;border:1px solid #81e6d9;color:#285e61;font-weight:700}
    .submit-button{
      width:100%;padding:16px 24px;font-size:16px;font-weight:600;
      background:linear-gradient(135deg,#2c5282 0%,#3182ce 100%);
      color:#fff;border:none;border-radius:12px;cursor:pointer;transition:all .3s ease;
      box-shadow:0 4px 15px rgba(44,82,130,.3);margin-top:10px;letter-spacing:.3px
    }
    .submit-button:hover{background:linear-gradient(135deg,#2a4c80 0%,#2c7cb8 100%);transform:translateY(-2px);box-shadow:0 6px 20px rgba(44,82,130,.4)}
    .submit-button:active{transform:translateY(0)}
    .submit-button:disabled{background:#a0aec0;cursor:not-allowed;transform:none;box-shadow:none}
    .btn-secondary{
      width:100%;padding:12px 20px;font-size:15px;font-weight:600;background:#edf2f7;color:#2d3748;
      border:none;border-radius:10px;cursor:pointer;transition:.2s; margin-top:10px
    }
    .btn-secondary:hover{background:#e2e8f0}
    .back-button{
      position:fixed;top:20px;left:20px;background:rgba(255,255,255,.9);backdrop-filter:blur(10px);
      border:none;padding:12px 16px;border-radius:50px;cursor:pointer;font-size:14px;font-weight:500;
      color:#2c5282;transition:all .3s ease;box-shadow:0 4px 15px rgba(0,0,0,.1);z-index:1000
    }
    .back-button:hover{background:#fff;transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.15)}
    /* Mobile */
    @media (max-width:768px){
      body{padding:15px}
      .header{padding:15px;border-radius:15px;margin-bottom:15px}
      .company-name{font-size:20px}
      .system-title{font-size:12px}
      .container{padding:25px 20px;border-radius:15px}
      .main-title{font-size:20px;margin-bottom:25px}
      .form-section{padding:20px 15px;border-radius:12px;margin-bottom:20px}
      .form-row{grid-template-columns:1fr;gap:0}
      .submit-button{padding:14px 20px;font-size:15px}
      .back-button{top:15px;left:15px;padding:10px 14px;font-size:13px}
    }
    @media (max-width:480px){
      .header,.container{max-width:100%}
      .main-title{font-size:18px}
      .section-title{font-size:15px}
      input,select{padding:10px 14px;font-size:14px}
    }
    @supports(padding:max(0px)){
      body{padding-top:max(20px,env(safe-area-inset-top));padding-bottom:max(20px,env(safe-area-inset-bottom))}
    }
    @keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    .header,.container{animation:fadeInUp .6s ease-out}.container{animation-delay:.2s}
    .loading{display:inline-block;width:20px;height:20px;border:2px solid #fff;border-radius:50%;border-top-color:transparent;animation:spin 1s ease-in-out infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <button class="back-button" onclick="history.back()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>

  <div class="header">
    <div class="logo-section">
      <div class="company-name">RMT CORPORATION</div>
      <div class="system-title">Visitor Registration System</div>
    </div>
  </div>

  <div class="container">
    <h2 class="main-title">üìã ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h2>

    <form id="visitorForm" autocomplete="off">
      <div class="form-section">
        <div class="section-title">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>

        <div class="form-group">
          <label for="fullName">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="required">*</span></label>
          <input type="text" id="fullName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô" required minlength="2" maxlength="120">
        </div>

        <div class="form-group">
          <label for="company">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î <span class="required">*</span></label>
          <input type="text" id="company" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô" required minlength="2" maxlength="120">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="carPlate">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</label>
            <input type="text" id="carPlate" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏Å 1234 / ABC 1234" inputmode="text" maxlength="12">
            <div class="muted">* ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å</div>
          </div>

          <div class="form-group">
            <label for="followers">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</label>
            <select id="followers">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
            <div class="row-inline muted" style="margin-top:8px">
              <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
              <span id="totalPeople" class="total-pill">1 ‡∏Ñ‡∏ô</span>
            </div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="section-title">üéØ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°</div>

        <div class="form-row">
          <div class="form-group">
            <label for="purpose">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå <span class="required">*</span></label>
            <select id="purpose" required>
              <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
              <option value="‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô</option>
              <option value="‡∏™‡πà‡∏á-‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á">‡∏™‡πà‡∏á-‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á</option>
              <option value="‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô</option>
              <option value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
            </select>
          </div>

          <div class="form-group" id="purposeOtherGroup" style="display:none">
            <label for="purposeOther">‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå (‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∑‡πà‡∏ô ‡πÜ) <span class="required">*</span></label>
            <input type="text" id="purposeOther" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°" maxlength="120">
          </div>

          <div class="form-group">
            <label for="department">‡πÅ‡∏ú‡∏ô‡∏Å <span class="required">*</span></label>
            <select id="department" required>
              <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
              <option value="PD">PD</option>
              <option value="PC">PC</option>
              <option value="‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á">‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á</option>
              <option value="‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠">‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠</option>
              <option value="‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•">‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</option>
              <option value="‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</option>
              <option value="IT">IT</option>
              <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="contactPerson">‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏ö <span class="required">*</span></label>
          <input type="text" id="contactPerson" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏ö" required minlength="2" maxlength="120">
        </div>

        <div class="form-group" style="margin-top:10px">
          <label class="row-inline" style="font-weight:500">
            <input type="checkbox" id="pdpaConsent" style="width:auto;margin-right:10px">
            ‡∏â‡∏±‡∏ô‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (PDPA) <span class="required" style="margin-left:6px">*</span>
          </label>
          <div class="muted" style="margin-top:6px">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</div>
        </div>
      </div>

      <button type="submit" class="submit-button" id="submitBtn">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</button>
      <button type="button" class="btn-secondary" id="resetBtn">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
    </form>
  </div>

  <script>
    // ---------- Helpers ----------
    const $ = (sel)=>document.querySelector(sel);
    const $$ = (sel)=>Array.from(document.querySelectorAll(sel));

    function formatCarPlate(val){
      val = val.toUpperCase().replace(/\s+/g,' ').trim();
      return val;
    }

    function calcTotal(){
      const followers = parseInt($('#followers').value || '0',10);
      const total = 1 + followers;
      $('#totalPeople').textContent = `${total} ‡∏Ñ‡∏ô`;
    }

    function getFormData(){
      const purposeValue = $('#purpose').value === '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ'
        ? ($('#purposeOther').value.trim() || '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ')
        : $('#purpose').value;

      return {
        fullName: $('#fullName').value.trim(),
        company: $('#company').value.trim(),
        carPlate: $('#carPlate').value.trim(),
        followers: $('#followers').value,
        purpose: purposeValue,
        contactPerson: $('#contactPerson').value.trim(),
        department: $('#department').value,
        total: 1 + parseInt($('#followers').value || '0',10),
        pdpa: $('#pdpaConsent').checked ? 'yes' : 'no',
        ts: new Date().toISOString()
      };
    }

    function setLoading(isLoading){
      const btn = $('#submitBtn');
      if(isLoading){
        btn.innerHTML = '<span class="loading"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code...';
        btn.disabled = true;
      }else{
        btn.innerHTML = '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÉ‡∏´‡∏°‡πà';
        btn.disabled = false;
      }
    }

    // ---------- Events ----------
    document.addEventListener('DOMContentLoaded', () => {
      // ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™
      $$('button').forEach(b=>{
        b.addEventListener('touchstart',function(){ this.style.transform='scale(0.98)'; });
        b.addEventListener('touchend',function(){ if(!this.disabled) this.style.transform=''; });
      });

      // Followers -> Total
      $('#followers').addEventListener('change', calcTotal);
      calcTotal();

      // Purpose other
      $('#purpose').addEventListener('change', ()=>{
        const showOther = $('#purpose').value === '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ';
        $('#purposeOtherGroup').style.display = showOther ? '' : 'none';
        if(!showOther) $('#purposeOther').value = '';
      });

      // Car plate format
      $('#carPlate').addEventListener('input', (e)=>{
        const pos = e.target.selectionStart;
        e.target.value = formatCarPlate(e.target.value);
        e.target.setSelectionRange(pos, pos);
      });

      // Restore from session
      const saved = sessionStorage.getItem('visitorFormData');
      if(saved){
        try{
          const d = JSON.parse(saved);
          if(d.fullName) $('#fullName').value = d.fullName;
          if(d.company) $('#company').value = d.company;
          if(d.carPlate) $('#carPlate').value = d.carPlate;
          if(d.followers!=null) $('#followers').value = String(d.followers);
          if(d.department) $('#department').value = d.department;
          if(d.purpose){
            $('#purpose').value = (['‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô','‡∏™‡πà‡∏á-‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á','‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô','‡∏≠‡∏∑‡πà‡∏ô ‡πÜ'].includes(d.purpose)) ? d.purpose : '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ';
            if($('#purpose').value==='‡∏≠‡∏∑‡πà‡∏ô ‡πÜ'){
              $('#purposeOtherGroup').style.display='';
              $('#purposeOther').value = (['‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô','‡∏™‡πà‡∏á-‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á','‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô','‡∏≠‡∏∑‡πà‡∏ô ‡πÜ'].includes(d.purpose)?'':d.purpose);
            }
          }
          if(d.pdpa==='yes') $('#pdpaConsent').checked = true;
          calcTotal();
        }catch{}
      }
    });

    // Enter -> next
    document.addEventListener('keydown', function(e){
      if(e.key==='Enter' && e.target.tagName==='INPUT'){
        e.preventDefault();
        const inputs = $$('#visitorForm input, #visitorForm select');
        const idx = inputs.indexOf(e.target);
        if(idx < inputs.length - 1){ inputs[idx+1].focus(); }
      }
    });

    // Reset
    $('#resetBtn').addEventListener('click', ()=>{
      $('#visitorForm').reset();
      $('#purposeOtherGroup').style.display='none';
      $('#totalPeople').textContent = '1 ‡∏Ñ‡∏ô';
      sessionStorage.removeItem('visitorFormData');
    });

    // Submit
    let submitting = false;
    $('#visitorForm').addEventListener('submit', function(e){
      e.preventDefault();
      if(submitting) return;
      const data = getFormData();

      // Validations
      if(!data.fullName || !data.company || !data.contactPerson || !data.department || !data.purpose){
        Swal.fire({icon:'warning',title:'‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö',text:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'}); return;
      }
      if($('#purpose').value==='‡∏≠‡∏∑‡πà‡∏ô ‡πÜ' && !$('#purposeOther').value.trim()){
        Swal.fire({icon:'warning',title:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå',text:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‚Äú‡∏≠‡∏∑‡πà‡∏ô ‡πÜ‚Äù'}); return;
      }
      if(!$('#pdpaConsent').checked){
        Swal.fire({icon:'info',title:'‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°',text:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡∏ï‡∏≤‡∏°‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (PDPA) ‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠'}); return;
      }

      // Save session
      sessionStorage.setItem('visitorFormData', JSON.stringify(data));

      submitting = true;
      setLoading(true);

      setTimeout(()=>{ // mock processing
        try{
          const compressed = LZString.compressToEncodedURIComponent(JSON.stringify(data));

          const wrap = document.createElement('div');
          wrap.innerHTML = `
            <h3 style="margin-bottom:12px;color:#2c5282;">üìÑ QR Code ‡∏ú‡∏π‡πâ‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h3>
            <div id="qr-code-container" style="display:flex;justify-content:center"></div>
            <div style="font-size:13px;margin-top:12px;color:#555;background:#fff;padding:12px;border-radius:10px;border-left:4px solid #3182ce">
              ‡πÇ‡∏õ‡∏£‡∏î‡∏¢‡∏∑‡πà‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
            </div>
          `;

          const container = wrap.querySelector('#qr-code-container');
          new QRCode(container, {
            text: compressed, width: 280, height: 280,
            colorDark:"#000000", colorLight:"#ffffff", correctLevel: QRCode.CorrectLevel.H
          });

          Swal.fire({
            title: 'QR Code ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
            html: wrap,
            width: 360,
            showDenyButton: true,
            confirmButtonText: '‡∏õ‡∏¥‡∏î',
            denyButtonText: '‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î QR',
          }).then(res=>{
            if(res.isDenied){
              try{
                const img = container.querySelector('img') || container.querySelector('canvas');
                const link = document.createElement('a');
                link.download = `visitor_qr_${Date.now()}.png`;
                link.href = (img.tagName==='CANVAS') ? img.toDataURL('image/png') : img.src;
                link.click();
              }catch(e){}
            }
          });

          setLoading(false);
        }catch(err){
          console.error('QR Error:', err);
          Swal.fire({icon:'error',title:'‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',text:'‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÑ‡∏î‡πâ'});
          $('#submitBtn').innerHTML = '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code';
          $('#submitBtn').disabled = false;
        }finally{
          submitting = false;
        }
      }, 500);
    });
  </script>
</body>
</html>
